"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _modal=_interopRequireDefault(require("./bootstrap/modal")),_carousel=_interopRequireDefault(require("./bootstrap/carousel"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(a="Object"===a&&t.constructor?t.constructor.name:a)||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(t,e):void 0}}function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,r=new Array(e);a<e;a++)r[a]=t[a];return r}function _defineProperty(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _createClass(t,e,a){return e&&_defineProperties(t.prototype,e),a&&_defineProperties(t,a),t}var bootstrap={Modal:_modal.default,Carousel:_carousel.default},Lightbox=function(){function r(t){var e=this,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,r),this.hash=this.randomHash(),this.settings=Object.assign(Object.assign(Object.assign({},bootstrap.Modal.Default),bootstrap.Carousel.Default),{interval:!1,target:'[data-toggle="lightbox"]',gallery:""}),this.modalOptions=e.setOptionsFromSettings(bootstrap.Modal.Default),this.carouselOptions=e.setOptionsFromSettings(bootstrap.Carousel.Default),console.log(),"string"==typeof t&&(this.settings.target=t,t=document.querySelector(this.settings.target),a=void 0!==arguments[1]?arguments[1]:{}),this.settings=Object.assign(Object.assign({},this.settings),a),this.el=t,this.type=t.dataset.type||"image",this.src=this.getSrc(t),this.src="image"!==this.type?"embed"+this.src:this.src,this.sources=this.getGalleryItems(),this.createCarousel(),this.createModal()}return _createClass(r,[{key:"show",value:function(){document.body.appendChild(this.modalElement),this.modal.show()}},{key:"hide",value:function(){this.modal.hide()}},{key:"setOptionsFromSettings",value:function(t){var a=this;return Object.keys(t).reduce(function(t,e){return Object.assign(t,_defineProperty({},e,a.settings[e]))},{})}},{key:"getSrc",value:function(t){return t.dataset.src||t.dataset.remote||t.href||"http://via.placeholder.com/1600x900"}},{key:"getGalleryItems",value:function(){var t,e=this;if(this.settings.gallery){if(Array.isArray(this.settings.gallery))return this.settings.gallery;t=this.settings.gallery}else this.el.dataset.gallery&&(t=this.el.dataset.gallery);return t?_toConsumableArray(new Set(Array.from(document.querySelectorAll('[data-gallery="'.concat(t,'"]')),function(t){return"".concat(t.dataset.type?"embed":"").concat(e.getSrc(t))}))):[this.src]}},{key:"getYoutubeId",value:function(t){if(!t)return!1;t=t.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/);return!(!t||11!==t[2].length)&&t[2]}},{key:"getInstagramEmbed",value:function(t){if(/instagram/.test(t))return t+=/\/embed$/.test(t)?"":"/embed",'<div class="ratio ratio-16x9" style="max-height: 100%;"><iframe src="'.concat(t,'" class="start-50 translate-middle-x" style="max-width: 500px" frameborder="0" scrolling="no" allowtransparency="true"></iframe></div>')}},{key:"isEmbed",value:function(t){var e=new RegExp(r.allowedEmbedTypes.join("|")).test(t),t=/\.(png|jpe?g|gif|svg|webp)/.test(t);return e||!t}},{key:"createCarousel",value:function(){var n=this,t=document.createElement("template"),e=this.sources.map(function(t,e){t=t.replace(/\/$/,"");var a="";a+=/\.png/.test(t)?"this.add.previousSibling.remove()":"";var r='<div class="ratio ratio-16x9"><img src="'.concat(t,'" class="d-block w-100 h-100 img-fluid" style="z-index: 1; object-fit: contain;" onload="').concat(a,'" /></div>'),o="",s=n.getInstagramEmbed(t),a=n.getYoutubeId(t);n.isEmbed(t)&&(/^embed/.test(t)&&(t=t.substring(5)),a&&(t="https://www.youtube.com/embed/".concat(a),o='title="YouTube video player" frameborder="0" allow="accelerometer autoplay clipboard-write encrypted-media gyroscope picture-in-picture"'),r=s||'<div class="ratio ratio-16x9"><iframe src="'.concat(t,'" ').concat(o," allowfullscreen></iframe></div>"));return'<div class="carousel-item '.concat(e?"":"active",'" style="min-height: 100px">').concat('<div class="position-absolute top-50 start-50 translate-middle text-white"><div class="spinner-border" style="width: 3rem height: 3rem" role="status"></div></div>').concat(r,"</div>")}).join(""),a=this.sources.length<2?"":'\n\t\t\t<button class="carousel-control carousel-control-prev h-75 m-auto" type="button" data-bs-target="#lightboxCarousel-'.concat(this.hash,'" data-bs-slide="prev">\n\t\t\t\t<span class="carousel-control-prev-icon" aria-hidden="true"></span>\n\t\t\t\t<span class="visually-hidden">Previous</span>\n\t\t\t</button>\n\t\t\t<button class="carousel-control carousel-control-next h-75 m-auto" type="button" data-bs-target="#lightboxCarousel-').concat(this.hash,'" data-bs-slide="next">\n\t\t\t\t<span class="carousel-control-next-icon" aria-hidden="true"></span>\n\t\t\t\t<span class="visually-hidden">Next</span>\n\t\t\t</button>'),a='\n\t\t\t<div id="lightboxCarousel-'.concat(this.hash,'" class="lightbox-carousel carousel" data-bs-ride="carousel">\n\t\t\t\t<div class="carousel-inner">\n\t\t\t\t\t').concat(e,"\n\t\t\t\t</div>\n\t\t\t\t").concat(a,"\n\t\t\t</div>");return t.innerHTML=a.trim(),this.carouselElement=t.content.firstChild,this.carousel=new bootstrap.Carousel(this.carouselElement,this.carouselOptions),this.carousel.to(this.sources.includes(this.src)?this.sources.indexOf(this.src):0),this.carousel}},{key:"createModal",value:function(){var e=this,t=document.createElement("template"),a='\n\t\t\t<div class="modal lightbox fade" id="lightboxModal-'.concat(this.hash,'" tabindex="-1" aria-hidden="true">\n\t\t\t\t<div class="modal-dialog modal-dialog-centered modal-xl">\n\t\t\t\t\t<div class="modal-content border-0" style="background: black">\n\t\t\t\t\t\t<div class="modal-body p-0">\n\t\t\t\t\t\t\t<button type="button" class="btn-close position-absolute top-0 end-0 p-3" data-bs-dismiss="modal" aria-label="Close" style="z-index: 2; background: none;">').concat('<svg xmlns="http://www.w3.org/2000/svg" style="position: relative; top: -5px;" viewBox="0 0 16 16" fill="#fff"><path d="M.293.293a1 1 0 011.414 0L8 6.586 14.293.293a1 1 0 111.414 1.414L9.414 8l6.293 6.293a1 1 0 01-1.414 1.414L8 9.414l-6.293 6.293a1 1 0 01-1.414-1.414L6.586 8 .293 1.707a1 1 0 010-1.414z"/></svg>)',"</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>");return t.innerHTML=a.trim(),this.modalElement=t.content.firstChild,this.modalElement.querySelector(".modal-body").appendChild(this.carouselElement),this.modalElement.addEventListener("hidden.bs.modal",function(t){return e.modalElement.remove()}),this.modal=new bootstrap.Modal(this.modalElement,this.modalOptions),this.modal}},{key:"randomHash",value:function(){return Array.from({length:0<arguments.length&&void 0!==arguments[0]?arguments[0]:8},function(){return Math.floor(36*Math.random()).toString(36)}).join("")}}]),r}();Lightbox.allowedEmbedTypes=["embed","youtube","vimeo","instagram","url"],Lightbox.allowedMediaTypes=[].concat(_toConsumableArray(Lightbox.allowedEmbedTypes),["image"]),Lightbox.defaultSelector='[data-toggle="lightbox"]',document.querySelectorAll(Lightbox.defaultSelector).forEach(function(e){return e.addEventListener("click",function(t){t.preventDefault(),new Lightbox(e).show()})});var _default=Lightbox;exports.default=_default;